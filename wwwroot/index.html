<!DOCTYPE html>
<html>
<head>
    <title>UniHelp Bildirimleri</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        #notificationsList { list-style-type: none; padding: 0; }
        #notificationsList li { background-color: #f0f0f0; margin-bottom: 10px; padding: 15px; border-left: 5px solid #007bff; }
    </style>
</head>
<body>

    <h1>Gerçek Zamanlı Bildirimler</h1>
    <hr />

    <div>
        <label for="tokenInput">JWT Token:</label>
        <input type="text" id="tokenInput" size="100" placeholder="Login olduktan sonra aldığınız token'ı buraya yapıştırın..." />
        <button id="connectButton">Bağlan</button>
    </div>
    <hr />

    <h3>Gelen Bildirimler:</h3>
    <ul id="notificationsList"></ul>

    <!-- SignalR JavaScript kütüphanesini ekliyoruz -->
    <script src="/lib/signalr.min.js"></script>
    
    <!-- En basit ve en temiz JavaScript kodu -->
    <script>
        document.getElementById("connectButton").addEventListener("click", function () {
            
            const token = document.getElementById("tokenInput").value;
            if (!token) {
                alert("Lütfen bir JWT token girin!");
                return;
            }

            console.log("Bağlantı isteği gönderiliyor...");

            // Bağlantıyı oluştur
            const connection = new signalR.HubConnectionBuilder()
                .withUrl("/notificationHub", { 
                    accessTokenFactory: () => token 
                })
                .configureLogging(signalR.LogLevel.Information)
                .build();

            // Sunucudan "ReceiveNotification" olayı geldiğinde ne yapılacağını tanımla
            connection.on("ReceiveNotification", (message) => {
                console.log("!!! BİLDİRİM GELDİ !!!:", message);
                const li = document.createElement("li");
                li.textContent = message;
                document.getElementById("notificationsList").appendChild(li);
            });

            // Bağlantıyı başlat
            connection.start()
                .then(() => {
                    console.log("Bağlantı başarıyla kuruldu! Artık bildirimler dinleniyor.");
                    document.getElementById("connectButton").disabled = true;
                })
                .catch(err => {
                    console.error("### BAĞLANTI HATASI ###:", err.toString());
                });
        });
    </script>
</body>
</html>